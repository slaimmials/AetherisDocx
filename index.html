<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Lua API — Документация</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Prism.js for syntax highlighting -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
  <style>
    :root {
      --bg: #181c20;
      --panel: #23272c;
      --accent: #3c4451;
      --border: #353a40;
      --text: #e2e3e5;
      --text-muted: #b0b3b8;
      --code-bg: #25282e;
      --code-border: #3e434a;
      --code: #e3e3d7;
      --tab-active: #25292e;
      --input-bg: #23272c;
      --input-border: #3a3f45;
      --card-bg: #202326;
      --card-border: #2d3136;
      --section-gap: 2.3rem;
      --searchlist-bg: #24272d;
    }
    body {
      background: var(--bg);
      color: var(--text);
      margin: 0;
      font-family: "Segoe UI", "Arial", sans-serif;
    }
    header {
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: 1.2rem 2rem 1.2rem 2rem;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
      font-size: 1.35rem;
      font-weight: bold;
      letter-spacing: 0.02em;
      justify-content: space-between;
      gap: 1.5rem;
    }
    .search-langs-row {
      display: flex;
      align-items: center;
      gap: 1.2em;
      margin: 0;
    }
    .lang-dropdown {
      position: relative;
      display: inline-block;
      z-index: 10;
    }
    .lang-dropdown-btn {
      background: var(--panel);
      color: var(--text-muted);
      border: 1px solid var(--input-border);
      border-radius: 4px;
      padding: 0.32em 1.6em 0.32em 0.9em;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.1s, color 0.1s, border 0.1s;
      outline: none;
      position: relative;
      min-width: 76px;
    }
    .lang-dropdown-btn:after {
      content: '';
      position: absolute;
      top: 54%;
      right: 0.8em;
      width: 0; height: 0;
      border-left: 6px solid transparent;
      border-right: 6px solid transparent;
      border-top: 5px solid var(--text-muted);
      pointer-events: none;
      transform: translateY(-50%);
    }
    .lang-dropdown.open .lang-dropdown-btn,
    .lang-dropdown-btn.active, .lang-dropdown-btn:focus {
      background: var(--tab-active);
      color: #fff;
      border-color: var(--accent);
      font-weight: 600;
    }
    .lang-dropdown-list {
      display: none;
      position: absolute;
      min-width: 120px;
      top: 100%;
      left: 0;
      background: var(--panel);
      border: 1px solid var(--input-border);
      border-radius: 0 0 6px 6px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      margin-top: 2px;
      z-index: 1000;
    }
    .lang-dropdown.open .lang-dropdown-list {
      display: block;
    }
    .lang-dropdown-list button {
      background: none;
      border: none;
      color: var(--text);
      width: 100%;
      text-align: left;
      padding: 0.6em 1em;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.1s, color 0.1s;
    }
    .lang-dropdown-list button:hover,
    .lang-dropdown-list button.active {
      background: var(--tab-active);
      color: #fff;
    }
    .search-box {
      display: flex;
      align-items: center;
      gap: 0.7em;
      margin: 0;
    }
    .search-box input {
      background: var(--input-bg);
      color: var(--text);
      border: 1px solid var(--input-border);
      border-radius: 5px;
      padding: 0.6em 1em;
      font-size: 1em;
      width: 260px;
      transition: border 0.13s;
      outline: none;
    }
    .search-box input:focus {
      border-color: var(--accent);
    }
    .search-suggest {
      background: var(--searchlist-bg);
      border: 1px solid var(--border);
      border-radius: 7px;
      margin: 0.1em 0 0 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.10);
      position: absolute;
      z-index: 100;
      width: 320px;
      max-width: 92vw;
      color: var(--text);
    }
    .search-suggest ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    .search-suggest li {
      padding: 0.7em 1.2em;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      font-size: 1em;
      transition: background 0.12s;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .search-suggest li:last-child {
      border-bottom: none;
    }
    .search-suggest li:hover,
    .search-suggest li.active {
      background: var(--accent);
      color: #fff;
    }
    .container {
      display: flex;
      min-height: 100vh;
    }
    nav {
      min-width: 210px;
      background: var(--panel);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: 1.5rem 0 1.5rem 0;
    }
    nav .tab-btn {
      background: none;
      border: none;
      color: var(--text);
      text-align: left;
      padding: 0.85rem 1.7rem;
      font-size: 1.08rem;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: background 0.13s, color 0.13s, border 0.13s;
      outline: none;
      font-weight: 500;
      letter-spacing: 0.01em;
    }
    nav .tab-btn.active, nav .tab-btn:focus {
      background: var(--tab-active);
      color: #fff;
      border-left: 3px solid var(--accent);
      font-weight: 600;
    }
    main {
      flex: 1;
      padding: 2rem 1.5rem 2rem 1.5rem;
      min-width: 0;
      overflow-x: auto;
    }
    section.tab-content > h1 {
      margin-bottom: 0.6em;
    }
    .card {
      background: var(--card-bg);
      border: 1.5px solid var(--card-border);
      border-radius: 11px;
      margin-bottom: var(--section-gap);
      padding: 1.2em 1.5em 1.2em 1.5em;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .card + .card {
      margin-top: 0.7em;
    }
    .card h2, .card h3 {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .card h2 {
      font-size: 1.28em;
      color: #f2b134;
    }
    .card h3 {
      font-size: 1.1em;
      color: #ffd54f;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 1.3em;
      margin-top: 0.5em;
      background: var(--panel);
      border-radius: 5px;
      overflow: hidden;
    }
    th, td {
      padding: 0.6em 0.95em;
      border-bottom: 1px solid var(--border);
      text-align: left;
      font-size: 1em;
    }
    th {
      background: var(--accent);
      color: #fff;
    }
    th[data-th="field"], td[data-td="field"] { color: #64b5f6 !important; }
    th[data-th="type"], td[data-td="type"] { color: #ba68c8 !important; }
    th[data-th="desc"], td[data-td="desc"] { color: #81c784 !important; }
    th[data-th="method"], td[data-td="method"] { color: #ffd54f !important; }
    th[data-th="returns"], td[data-td="returns"] { color: #ba68c8 !important; }
    pre[class*="language-"] {
      background: var(--code-bg) !important;
      border: 1px solid var(--code-border);
      border-radius: 7px;
      padding: 1em;
      margin: 0.7em 0 1.2em 0;
      font-size: 0.98em;
      overflow-x: auto;
      font-family: "Fira Mono", "Consolas", "Courier New", monospace;
      color: var(--code);
    }
    code[class*="language-"] {
      font-size: 0.98em;
      background: none !important;
      border: none !important;
      padding: 0;
    }
    code.inline {
      background: var(--code-bg);
      color: var(--code);
      padding: 0.13em 0.4em;
      border-radius: 4px;
      border: 1px solid var(--code-border);
      font-size: 0.98em;
    }
    mark {
      background: #614d2f;
      color: #ffeaaa;
      border-radius: 2px;
      padding: 0 3px;
    }
    @media (max-width: 900px) {
      .container {
        flex-direction: column;
      }
      nav {
        flex-direction: row;
        min-width: 0;
        border-right: none;
        border-bottom: 1px solid var(--border);
        overflow-x: auto;
        gap: 0;
        padding: 0 0;
        justify-content: flex-start;
      }
      nav .tab-btn {
        padding: 0.8rem 1.1rem;
        font-size: 0.99rem;
        border-left: none;
        border-bottom: 3px solid transparent;
      }
      nav .tab-btn.active, nav .tab-btn:focus {
        border-left: none;
        border-bottom: 3px solid var(--accent);
      }
      .search-suggest { width: 100vw; left: 0 !important;}
    }
    @media (max-width: 600px) {
      main {
        padding: 1rem 0.4rem 1rem 0.4rem;
      }
      .search-box input {
        width: 100%;
        min-width: 0;
      }
      .card {
        padding: 0.7em 0.6em 0.7em 0.7em;
        margin-bottom: 1.3rem;
      }
      .search-suggest { width: 99vw; left: 0 !important;}
    }
  </style>
</head>
<body>
  <header>
    <span id="title-main">Lua API — Документация</span>
    <span class="search-langs-row">
      <div class="lang-dropdown" id="langDropdown">
        <button id="langDropdownBtn" class="lang-dropdown-btn" type="button">Русский</button>
        <div class="lang-dropdown-list" id="langDropdownList">
          <button type="button" data-lang="ru" class="active">Русский</button>
          <button type="button" data-lang="en">English</button>
        </div>
      </div>
      <span class="search-box" id="searchbox">
        <div style="position:relative;display:inline-block;width:auto;">
          <input type="text" id="searchInput" placeholder="Поиск по API..." autocomplete="off">
          <div id="searchSuggest" class="search-suggest" style="display:none;position:absolute;top:100%;right:0;"></div>
        </div>
      </span>
    </span>
  </header>
  <div class="container">
    <nav id="nav">
      <button class="tab-btn active" data-tab="functions"><span class="tr" data-tr="nav-functions">Функции</span></button>
      <button class="tab-btn" data-tab="classes"><span class="tr" data-tr="nav-classes">Классы</span></button>
      <button class="tab-btn" data-tab="examples"><span class="tr" data-tr="nav-examples">Примеры</span></button>
    </nav>
    <main>
      <section id="tab-functions" class="tab-content" style="display:block;">
        <h1 class="tr" data-tr="functions-title" style="color:#ffd54f;">Функции</h1>
        <div id="auto-functions"></div>
      </section>
      <section id="tab-classes" class="tab-content" style="display:none;">
        <h1 class="tr" data-tr="classes-title" style="color:#ffd54f;">Классы и структуры</h1>
        <div id="auto-classes"></div>
      </section>
      <section id="tab-examples" class="tab-content" style="display:none;">
        <h1 class="tr" data-tr="examples-title" style="color:#ffd54f;">Примеры Lua-кода</h1>
        <div id="auto-examples"></div>
      </section>
    </main>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-lua.min.js"></script>
  <script>
    // ===== LIBRARY FOR AUTODOC =====
    class ApiDocu {
      static colorizeType(type) {
        const map = {
          float:   '#ba68c8',
          int:     '#ba68c8',
          string:  '#81c784',
          bool:    '#ffd54f',
          'uint8_t':'#ba68c8',
          Vector2: '#f2b134',
          Vector3: '#f2b134',
          Color:   '#f2b134',
          Player:  '#f2b134',
          Ents:    '#f2b134',
          GameWorld:'#f2b134'
        };
        return `<span style="color:${map[type]||'#fff'}">${type}</span>`;
      }

      static renderFieldRow(field, hasDesc) {
        const trStyle = field.private ? ' style="opacity:.55;"' : '';
        return `<tr${trStyle}>
          <td data-td="field"><span style="color:#64b5f6;">${field.name}</span>${field.private ? ' <span style="background:#c62828; color:#fff; border-radius:3px;padding:0 7px;font-size:0.97em;margin-left:7px;">private</span>' : ''}</td>
          <td data-td="type">${this.colorizeType(field.type)}</td>
          ${hasDesc ? `<td data-td="desc">${field.desc ? `<span style="color:#81c784;">${field.desc}</span>` : ''}</td>` : '<td></td>'}
        </tr>`;
      }

      static renderMethodRow(method, hasDesc) {
        const argNames = (method.args || []).map(a => a.name).join(', ');
        let argsBlock = '';
        if (method.args && method.args.length) {
          argsBlock = `<div style="margin-left:1.7em;font-size:0.97em;margin-top:2px;">
            ${method.args.map(
              arg => `<div><b>${arg.name}</b>: <span style="color:#ba68c8;">${arg.type}</span>${arg.desc ? ` — <span style="color:#aaa;">${arg.desc}</span>` : ''}</div>`
            ).join('')}
          </div>`;
        }
        // Вот тут добавляем бейдж "private" если method.private
        return `<tr${method.private ? ' style="opacity:.55;"' : ''}>
          <td data-td="method">
            <span style="color:#f2b134;">${method.name}(${argNames})</span>
            ${method.private ? ' <span style="background:#c62828;color:#fff;border-radius:3px;padding:0 7px;font-size:0.97em;margin-left:7px;">private</span>' : ''}
            ${argsBlock}
          </td>
          <td data-td="returns" style="vertical-align:top;">${ApiDocu.colorizeType(method.returns)}</td>
          ${hasDesc ? `<td data-td="desc" style="vertical-align:top;">${method.desc||''}</td>` : ''}
        </tr>`;
      }

      static renderStruct(s) {
        const hasDesc = s.fields.some(f => f.desc);
        return `<div class="card">
          <h2 style="color:#f2b134;">${s.name}</h2>
          <table>
            <tr>
              <th data-th="field" style="color:#64b5f6;">${ApiDocu._th('field')}</th>
              <th data-th="type" style="color:#ba68c8;">${ApiDocu._th('type')}</th>
              <th data-th="desc" style="color:#81c784;">${ApiDocu._th('desc')}</th>
            </tr>
            ${s.fields.map(f => ApiDocu.renderFieldRow(f, hasDesc)).join('')}
          </table>
          ${!s.noConstructor ? `
          <b style="color:#ffd54f;">${ApiDocu._th('constructor')}</b>
          <pre class="language-lua"><code class="language-lua">${s.name}(${s.fields.map(f=>`${f.name}: ${f.type}`).join(', ')})</code></pre>
          ` : ''}
          ${s.privateNote ? `<div style="font-size:0.98em;color:#ff8a65;margin:-0.5em 0 1.1em 0;">${s.privateNote}</div>` : ''}
          ${s.methods && s.methods.length ? `
          <b style="color:#ffd54f;">${ApiDocu._th('methods')}</b>
          <table>
            <tr>
              <th data-th="method" style="color:#ffd54f;">${ApiDocu._th('method')}</th>
              <th data-th="returns" style="color:#ba68c8;">${ApiDocu._th('returns')}</th>
              <th data-th="desc" style="color:#81c784;">${s.methods.some(m=>m.desc) ? ApiDocu._th('desc') : ""}</th>
            </tr>
            ${s.methods.map(m=>ApiDocu.renderMethodRow(m, s.methods.some(m=>m.desc))).join('')}
          </table>
          ` : ''}
        </div>`;
      }

      static renderFunction(f) {
        return `<div class="card">
          <h2 style="color:#f2b134;">${f.name}</h2>
          <p style="color:#90caf9;">${f.desc||''}</p>
          <table>
            <tr>
              <th data-th="param" style="color:#64b5f6;">${ApiDocu._th('param')}</th>
              <th data-th="type" style="color:#ba68c8;">${ApiDocu._th('type')}</th>
              <th data-th="desc" style="color:#81c784;">${ApiDocu._th('desc')}</th>
            </tr>
            ${(f.args||[]).map(a=>`<tr>
              <td data-td="field"><span style="color:#64b5f6;">${a.name}</span></td>
              <td data-td="type">${this.colorizeType(a.type)}</td>
              <td data-td="desc">${a.desc ? `<span style="color:#81c784;">${a.desc}</span>` : ''}</td>
            </tr>`).join('')}
          </table>
          <b style="color:#ffd54f;">${ApiDocu._th('returns')}</b> <code class="inline">${f.returns||'nil'}</code>
          ${f.example ? `<h4 style="color:#90caf9;">${ApiDocu._th('example')}</h4>
          <pre class="language-lua"><code class="language-lua">${f.example}</code></pre>` : ''}
        </div>`;
      }

      static renderExample(ex) {
        return `<div class="card">
          <h2 style="color:#f2b134;">${ex.title}</h2>
          <pre class="language-lua"><code class="language-lua">${ex.code}</code></pre>
        </div>`;
      }

      // Localization for table headers
      static _th(term) {
        if (window.ApiDocuLangs && window.ApiDocuLangs[window.currentLang||'ru'] && window.ApiDocuLangs[window.currentLang||'ru'][term]) {
          return window.ApiDocuLangs[window.currentLang||'ru'][term];
        }
        // fallback
        const d = {
          field:'Field', type:'Type', desc:'Description', constructor:'Constructor:', methods:'Methods:', method:'Method', returns:'Returns', param:'Parameter', example:'Example'
        };
        return d[term]||term;
      }

      static renderAll(data, container, mode) {
        // mode: "struct" | "function" | "example"
        if (mode === "struct") container.innerHTML = data.map(s=>this.renderStruct(s)).join('');
        if (mode === "function") container.innerHTML = data.map(f=>this.renderFunction(f)).join('');
        if (mode === "example") container.innerHTML = data.map(ex=>this.renderExample(ex)).join('');
        if(window.Prism) Prism.highlightAll();
      }
    }
    window.ApiDocu = ApiDocu;
    // ===== END LIBRARY =====

    // ==== YOUR DATA (multi-lang ready, ru/en) ====
    window.ApiDocuLangs = {
      ru: {
        field: "Поле",
        type: "Тип",
        desc: "Описание",
        constructor: "Конструктор:",
        methods: "Методы:",
        method: "Метод",
        returns: "Возвращает:",
        param: "Параметр",
        example: "Пример"
      },
      en: {
        field: "Field",
        type: "Type",
        desc: "Description",
        constructor: "Constructor:",
        methods: "Methods:",
        method: "Method",
        returns: "Returns:",
        param: "Parameter",
        example: "Example"
      }
    };

    const docFunctions = [
      {
        name: "draw.rect",
        desc: {
          ru: "Рисует прямоугольник по координатам.",
          en: "Draws a rectangle at the specified coordinates."
        },
        args: [
          {name: "x", type:"float", desc: {ru:"X-координата",en:"X coordinate"}},
          {name: "y", type:"float", desc: {ru:"Y-координата",en:"Y coordinate"}},
          {name: "w", type:"float", desc: {ru:"Ширина",en:"Width"}},
          {name: "h", type:"float", desc: {ru:"Высота",en:"Height"}},
          {name: "color", type:"Color", desc: {ru:"Цвет",en:"Color"}}
        ],
        returns: "Rect",
        example: "draw.rect(10, 20, 100, 50, Color(255, 0, 0, 255))"
      },
      {
        name: "draw.text",
        desc: {
          ru: "Рисует текст по координатам.",
          en: "Draws text at the specified coordinates."
        },
        args: [
          {name: "x", type:"float", desc: {ru:"X-координата",en:"X coordinate"}},
          {name: "y", type:"float", desc: {ru:"Y-координата",en:"Y coordinate"}},
          {name: "text", type:"string", desc: {ru:"Текст",en:"Text"}},
          {name: "color", type:"Color", desc: {ru:"Цвет",en:"Color"}}
        ],
        returns: "Text",
        example: 'draw.text(50, 100, "Hello World", Color(255,255,255,255))'
      }
    ];

    const docStructs = [
      {
        name: "Vector2",
        fields: [
          { name: "x", type: "float", desc: {ru:"X-координата",en:"X coordinate"} },
          { name: "y", type: "float", desc: {ru:"Y-координата",en:"Y coordinate"} }
        ]
      },
      {
        name: "Vector3",
        fields: [
          { name: "x", type: "float", desc: {ru:"X-координата",en:"X coordinate"} },
          { name: "y", type: "float", desc: {ru:"Y-координата",en:"Y coordinate"} },
          { name: "z", type: "float", desc: {ru:"Z-координата",en:"Z coordinate"} }
        ]
      },
      {
        name: "Color",
        fields: [
          { name: "r", type: "uint8_t" },
          { name: "g", type: "uint8_t" },
          { name: "b", type: "uint8_t" },
          { name: "a", type: "uint8_t" }
        ]
      },
      {
        name: "Player",
        noConstructor: true,
        fields: [
          { name: "alive", type: "bool",  desc: {ru:"Жив ли игрок", en:"Is player alive"} },
          { name: "scoped", type: "bool", desc: {ru:"В прицеле ли", en:"Is scoped"} },
          { name: "health", type: "float",  desc: {ru:"Текущее здоровье", en:"Current health"} },
          { name: "team", type: "float",  desc: {ru:"Номер команды", en:"Team number"} },
          { name: "pos", type: "Vector3",  desc: {ru:"Позиция", en:"Position"} },
          { name: "velocity", type: "Vector3",  desc: {ru:"Скорость", en:"Velocity"} },
          { name: "pawnAddr", type: "uintptr_t", private: true },
          { name: "controllerAddr", type: "uintptr_t", private: true }
        ],
        methods: [
          { name: "isValid", args: [], returns: "bool", desc: {ru:"Проверяет валидность игрока", en:"Checks if player valid"} },
        ]
      },
      {
        name: "Rect",
        noConstructor: true,
        fields: [
          { name: "p1", type: "Vector2", desc: "Top-left corner" },
          { name: "p2", type: "Vector2", desc: "Bottom-right corner" },
          { name: "color", type: "Color", desc: "Rectangle color" },
          { name: "rounding", type: "float", desc: "Corner radius" },
          { name: "visible", type: "bool", desc: "Is rectangle visible", default: "true" },
          { name: "destroyed", type: "bool", desc: "Was rectangle destroyed", default: "false" }
        ]
      },
      {
        name: "Text",
        noConstructor: true,
        fields: [
          { name: "pos", type: "Vector2", desc: "Text position" },
          { name: "text", type: "string", desc: "Text string" },
          { name: "color", type: "Color", desc: "Text color" },
          { name: "size", type: "float", desc: "Font size" },
          { name: "visible", type: "bool", desc: "Is text visible", default: "true" },
          { name: "destroyed", type: "bool", desc: "Was text destroyed", default: "false" }
        ]
      },
      {
        name: "Ents",
        noConstructor: true,
        fields: [
          { name: "clientBase", type: "uintptr_t", private: true }
        ],
        //privateNote: '<b>clientBase</b> — <span>приватное поле, недоступно из Lua</span>',
        methods: [
          { name: "LocalPlayer", args: [], returns: "Player", desc: {ru:"Локальный игрок", en:"Local player"} },
          { name: "GetPlayers", 
            args: [
              {name:"skipLocal",type:"bool"},
              {name:"test",type:"float"},
            ], 
            returns: "table<Player>", 
            desc: {ru:"Список игроков", en:"List of players"} 
          }
        ]
      },
      {
        name: "GameWorld",
        noConstructor: true,
        fields: [
          { name: "ents", type: "Ents" }
        ],
        methods: [
          { name: "isLoaded", private: true, args: [], returns: "bool", desc: {ru:"Загружен ли мир", en:"Is world loaded"} }
        ]
      }
    ];

    const docExamples = [
      {
        title: {ru:"Получить всех игроков",en:"Get all players"},
        code:
`for _, player in ipairs(world.ents:GetPlayers()) do
    if player:isValid() and player:alive() then
        print(player:pos().x, player:pos().y, player:pos().z)
    end
end`
      },
      {
        title: {ru:"Проверить локального игрока",en:"Check local player"},
        code:
`localplayer = world.ents:LocalPlayer()
if localplayer:isValid() then
    print("HP:", localplayer:health())
end`
      }
    ];

    // ====== LANG SWITCHER, SEARCH, TABS, ETC (как раньше) =====

    // Языки: ru / en
    const LANGS = {
      ru: {
        "title-main": "Lua API — Документация",
        "nav-functions": "Функции",
        "nav-classes": "Классы",
        "nav-examples": "Примеры",
        "functions-title": "Функции",
        "classes-title": "Классы и структуры",
        "examples-title": "Примеры Lua-кода",
        "draw_rect-desc": "Рисует прямоугольник по координатам.",
        "draw_text-desc": "Рисует текст по координатам.",
        "returns": "Возвращает:",
        "example": "Пример",
        "example-lua": "Пример Lua",
        "param": "Параметр",
        "type": "Тип",
        "desc": "Описание",
        "field": "Поле",
        "constructor": "Конструктор:",
        "methods": "Методы:",
        "method": "Метод",
        "x-desc": "X-координата",
        "y-desc": "Y-координата",
        "w-desc": "Ширина",
        "h-desc": "Высота",
        "color-desc": "Цвет",
        "text-desc": "Текст",
        "example-getplayers": "Получить всех игроков",
        "example-localplayer": "Проверить локального игрока"
      },
      en: {
        "title-main": "Lua API — Documentation",
        "nav-functions": "Functions",
        "nav-classes": "Classes",
        "nav-examples": "Examples",
        "functions-title": "Functions",
        "classes-title": "Classes and Structures",
        "examples-title": "Lua Code Examples",
        "draw_rect-desc": "Draws a rectangle at the specified coordinates.",
        "draw_text-desc": "Draws text at the specified coordinates.",
        "returns": "Returns:",
        "example": "Example",
        "example-lua": "Lua Example",
        "param": "Parameter",
        "type": "Type",
        "desc": "Description",
        "field": "Field",
        "constructor": "Constructor:",
        "methods": "Methods:",
        "method": "Method",
        "x-desc": "X coordinate",
        "y-desc": "Y coordinate",
        "w-desc": "Width",
        "h-desc": "Height",
        "color-desc": "Color",
        "text-desc": "Text",
        "example-getplayers": "Get all players",
        "example-localplayer": "Check local player"
      }
    };
    let currentLang = localStorage.getItem('api_lang') || 'ru';

    function switchLang(lang) {
      if (!LANGS[lang]) return;
      currentLang = lang;
      localStorage.setItem('api_lang', lang);
      window.currentLang = lang;
      document.documentElement.lang = lang;
      
      // Заголовок
      document.getElementById("title-main").textContent = LANGS[lang]["title-main"];
      // Табы, заголовки, подписи
      document.querySelectorAll('.tr').forEach(el => {
        const tr = el.getAttribute('data-tr');
        if (tr && LANGS[lang][tr]) el.textContent = LANGS[lang][tr];
      });
      // Placeholder поиска
      document.getElementById('searchInput').placeholder = lang === 'ru' ? 'Поиск по API...' : 'Search API...';
      // Dropdown UI
      document.querySelectorAll('.lang-dropdown-list button').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });
      document.getElementById('langDropdownBtn').textContent = lang === 'ru' ? 'Русский' : 'English';
      // Search suggestions обновить
      updateSuggestList();
      // Ререндерим автодоки
      renderAutodocu();
    }

    // Dropdown logic
    const langDropdown = document.getElementById('langDropdown');
    const langDropdownBtn = document.getElementById('langDropdownBtn');
    const langDropdownList = document.getElementById('langDropdownList');
    langDropdownBtn.addEventListener('click', function(e) {
      langDropdown.classList.toggle('open');
    });
    langDropdownList.querySelectorAll('button').forEach(btn => {
      btn.addEventListener('click', function(e) {
        switchLang(this.dataset.lang);
        langDropdown.classList.remove('open');
      });
    });
    document.addEventListener('mousedown', function(e) {
      if (!langDropdown.contains(e.target)) langDropdown.classList.remove('open');
    });

    // Вкладки и боковое меню
    function setActiveTab(tab) {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === tab);
      });
      document.querySelectorAll('.tab-content').forEach(sec => {
        sec.style.display = sec.id === 'tab-' + tab ? 'block' : 'none';
      });
    }
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => setActiveTab(btn.dataset.tab));
    });

    // Поиск с подсказками
    const searchInput = document.getElementById('searchInput');
    const searchSuggest = document.getElementById('searchSuggest');
    // Индексы для поиска
    const SEARCH_INDEX = [
      // Функции
      {type: 'function', name: {'ru':'draw.rect','en':'draw.rect'}, section: 'functions', anchor: 'draw_rect', label: {'ru': 'Функция', 'en': 'Function'}},
      {type: 'function', name: {'ru':'draw.text','en':'draw.text'}, section: 'functions', anchor: 'draw_text', label: {'ru': 'Функция', 'en': 'Function'}},
      // Классы
      {type: 'class', name: {'ru':'Vector2','en':'Vector2'}, section: 'classes', anchor: 'Vector2', label: {'ru':'Класс','en':'Class'}},
      {type: 'class', name: {'ru':'Vector3','en':'Vector3'}, section: 'classes', anchor: 'Vector3', label: {'ru':'Класс','en':'Class'}},
      {type: 'class', name: {'ru':'Color','en':'Color'}, section: 'classes', anchor: 'Color', label: {'ru':'Класс','en':'Class'}},
      {type: 'class', name: {'ru':'Player','en':'Player'}, section: 'classes', anchor: 'Player', label: {'ru':'Класс','en':'Class'}},
      {type: 'class', name: {'ru':'Ents','en':'Ents'}, section: 'classes', anchor: 'Ents', label: {'ru':'Класс','en':'Class'}},
      {type: 'class', name: {'ru':'GameWorld','en':'GameWorld'}, section: 'classes', anchor: 'GameWorld', label: {'ru':'Класс','en':'Class'}},
      // Примеры
      {type: 'example', name: {'ru':'Получить всех игроков','en':'Get all players'}, section: 'examples', anchor: '', label: {'ru':'Пример','en':'Example'}},
      {type: 'example', name: {'ru':'Проверить локального игрока','en':'Check local player'}, section: 'examples', anchor: '', label: {'ru':'Пример','en':'Example'}}
    ];

    function highlightMatches(text, query) {
      if (!query) return text;
      const re = new RegExp('('+query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')+')', 'gi');
      return text.replace(re, '<mark>$1</mark>');
    }

    function updateSuggestList() {
      if (searchInput.value.trim()) {
        const event = new Event('input');
        searchInput.dispatchEvent(event);
      }
    }

    searchInput.addEventListener('input', function() {
      const q = this.value.trim().toLowerCase();
      document.querySelectorAll('.tab-content').forEach(sec => {
        sec.querySelectorAll('mark').forEach(m => {
          const txt = document.createTextNode(m.textContent);
          m.replaceWith(txt);
        });
        if (!q) return;
        sec.querySelectorAll('h2, h3, h4, p, td, th').forEach(node => {
          let html = node.innerHTML;
          if (!html.toLowerCase().includes(q)) return;
          html = html.replace(new RegExp('('+q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')+')', 'gi'), '<mark>$1</mark>');
          node.innerHTML = html;
        });
      });
      if (q.length === 0) {
        searchSuggest.style.display = 'none';
        searchSuggest.innerHTML = '';
        return;
      }
      const items = SEARCH_INDEX
        .filter(item => (item.name[currentLang] || item.name['ru']).toLowerCase().includes(q))
        .slice(0, 8);

      if (items.length) {
        let html = '<ul>';
        items.forEach(item => {
          html += `<li data-section="${item.section}" data-anchor="${item.anchor}">${highlightMatches(item.name[currentLang] || item.name['ru'], q)} <span style="color:var(--text-muted);font-size:0.97em;">(${item.label[currentLang]})</span></li>`;
        });
        html += '</ul>';
        searchSuggest.innerHTML = html;
        searchSuggest.style.display = 'block';
      } else {
        searchSuggest.innerHTML = '';
        searchSuggest.style.display = 'none';
      }
    });

    searchSuggest.addEventListener('mousedown', function(e) {
      let li = e.target;
      while (li && li.tagName !== "LI") li = li.parentElement;
      if (!li) return;
      const section = li.getAttribute('data-section');
      const anchor = li.getAttribute('data-anchor');
      setActiveTab(section);
      if (anchor) {
        const el = document.getElementById(anchor);
        if (el) {
          el.scrollIntoView({behavior: "smooth", block: "start", inline: "nearest"});
          window.location.hash = "#" + anchor;
        }
      }
      searchSuggest.style.display = 'none';
      searchInput.blur();
      setTimeout(() => searchInput.focus(), 10);
    });

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        searchSuggest.style.display = 'none';
        setTimeout(() => searchInput.focus(), 10);
      });
    });
    document.addEventListener('click', (e) => {
      if (!searchSuggest.contains(e.target) && e.target !== searchInput) {
        searchSuggest.style.display = 'none';
      }
    });

    document.querySelectorAll('h2[id]').forEach(h => {
      h.style.cursor = "pointer";
      h.title = "Скопировать ссылку на этот раздел";
      h.addEventListener('click', function() {
        window.location.hash = '#' + this.id;
      });
    });

    function onHashChange() {
      const hash = window.location.hash.slice(1);
      if(!hash) return;
      const sec = document.getElementById(hash);
      if(sec) {
        if(sec.closest('#tab-classes')) setActiveTab('classes');
        if(sec.closest('#tab-functions')) setActiveTab('functions');
      }
    }
    window.addEventListener('hashchange', onHashChange);
    onHashChange();

    function highlightAllLua() {
      Prism.highlightAll();
    }

    // === Автоматический рендер секций ===
    function renderAutodocu() {
      // Функции
      ApiDocu.renderAll(
        docFunctions.map(f=>({
          ...f,
          desc: typeof f.desc === 'object' ? f.desc[currentLang]||f.desc['ru'] : f.desc,
          args: f.args ? f.args.map(a=>({
            ...a,
            desc: a.desc ? (typeof a.desc === 'object' ? a.desc[currentLang]||a.desc['ru'] : a.desc) : undefined
          })) : []
        })),
        document.getElementById('auto-functions'),
        "function"
      );
      // Классы/структуры
      ApiDocu.renderAll(
        docStructs.map(s=>({
          ...s,
          fields: s.fields.map(f=>({
            ...f,
            desc: f.desc ? (typeof f.desc === 'object' ? f.desc[currentLang]||f.desc['ru'] : f.desc) : undefined
          })),
          methods: s.methods ? s.methods.map(m=>({
            ...m,
            desc: m.desc ? (typeof m.desc === 'object' ? m.desc[currentLang]||m.desc['ru'] : m.desc) : undefined
          })) : [],
          privateNote: s.privateNote
        })),
        document.getElementById('auto-classes'),
        "struct"
      );
      // Примеры
      ApiDocu.renderAll(
        docExamples.map(ex=>({
          ...ex,
          title: typeof ex.title === 'object' ? ex.title[currentLang]||ex.title['ru'] : ex.title
        })),
        document.getElementById('auto-examples'),
        "example"
      );
    }

    document.addEventListener('DOMContentLoaded', function() {
      switchLang(currentLang);
      highlightAllLua();
    });
    searchInput.addEventListener('input', highlightAllLua);
  </script>
</body>
</html>